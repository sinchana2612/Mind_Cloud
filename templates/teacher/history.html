<!DOCTYPE html>
<html>
<head>
    <title>Teacher History</title>

<script async src="https://www.googletagmanager.com/gtag/js?id=G-482XK0D475"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-482XK0D475');
</script>

<style>
    body { font-family: Arial, sans-serif; background: #fbe9e7; margin: 0; }
    .navbar {
        background: #c62828; color: white;
        padding: 12px 25px;
        display:flex; justify-content:space-between; align-items:center;
    }
    .navbar a { color:white; margin-left:20px; text-decoration:none; font-weight:bold; }
    .navbar .logout { background:white; color:#c62828; padding:6px 12px; border-radius:4px; }

    .container{ padding:30px; }
    .card{ background:white; padding:25px; border-radius:8px;
        box-shadow:0 4px 10px rgba(0,0,0,0.1); }

    h2{ color:#c62828; margin-bottom:20px; }

    table{ width:100%; border-collapse:collapse; }
    th,td{
        padding:12px; border-bottom:1px solid #ddd;
        text-align:left; vertical-align:top;
    }
    th{ background:#ef5350; color:white; }

    .reply-btn{
        background:#c62828; color:white;
        padding:6px 14px; border-radius:4px;
        text-decoration:none; font-weight:bold;
        font-size:14px;
    }
    .reply-btn:hover{ background:#b71c1c; }

    .disabled-btn{
        background:#777 !important;
        pointer-events:none;
        cursor:not-allowed;
    }

    .pending{ color:#c62828; font-weight:bold; }
    .completed{ color:green; font-weight:bold; }
    .closed{ color:#777; font-weight:bold; }

    .date{ font-size:13px; color:#555; }
</style>
</head>
<body>

<div class="navbar">
    <span class="brand">Teacher Panel</span>
    <div>
        <a href="/teacher/dashboard">Dashboard</a>
        <a href="/teacher/request">Requests</a>
        <a href="/teacher/history">History</a>
        <a href="/logout" class="logout">Logout</a>
    </div>
</div>

<div class="container">
    <div class="card">
        <h2>Counselling History</h2>

        {% if history %}
        <table>
            <tr>
                <th>Student</th>
                <th>Problem</th>
                <th>Your Response</th>
                <th>Status</th>
                <th>Feedback</th>
                <th>Date</th>
                <th>Open</th>
            </tr>

            {% for h in history %}
            <tr>
                <td>
                    {% if h.confidential == 1 %}
                        Anonymous
                    {% else %}
                        {{ h.student_name }}
                    {% endif %}
                </td>

                <td>
                    {% if h.confidential == 1 %}
                        üîí Confidential
                    {% else %}
                        {{ h.problem }}
                    {% endif %}
                </td>

                <td>
                    {% if h.confidential == 1 %}
                        üîí Hidden
                    {% else %}
                        {{ h.teacher_response or '‚Äî' }}
                    {% endif %}
                </td>

                <td class="{% if h.is_closed == 1 %}closed{% elif h.teacher_response %}completed{% else %}pending{% endif %}">
                    {% if h.is_closed == 1 %}
                        ENDED
                    {% elif h.teacher_response %}
                        Completed
                    {% else %}
                        Pending
                    {% endif %}
                </td>

                <td>
                    {% if h.student_rating %}
                        ‚≠ê {{ h.student_rating }}/5<br>
                    {% else %}
                        ‚Äî
                    {% endif %}
                </td>

                <td class="date">
                    {{ h.created_at.strftime("%Y-%m-%d %H:%M") }}
                </td>

                <td>
                 <a class="reply-btn" href="/teacher/reply/{{ h.request_id }}">
                    {% if h.is_closed == 1 %}
                        View Chat
                    {% else %}
                        Open Chat
                    {% endif %}
                 </a>
                </td>

            </tr>
            {% endfor %}
        </table>

        {% else %}
        <p>No counselling history available.</p>
        {% endif %}
    </div>
</div>

</body>
</html>
